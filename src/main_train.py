# Main training loop as described in the paper